const elements={toastContainer:document.getElementById("toastContainer"),loginExpiredModal:document.getElementById("loginExpiredModal"),loginButton:document.getElementById("loginButton"),loginInfo:document.getElementById("loginInfo"),username:document.getElementById("username"),refresh:document.getElementById("refresh"),loginInfoPFP:document.getElementById("loginInfoPFP"),cells:document.querySelectorAll(".bingo-cell"),board:document.getElementById("board"),channel:document.getElementById("channel")};let loginExpiredModal,TWITCH={channel:"",access_token:"",userID:""};function login(){return elements.loginInfoPFP.src="https://guessr.tv/pics/donk.png",elements.loginButton.innerHTML=spinner,window.open("https://bingo.guessr.tv/prompt","loginWindow","toolbar=0,status=0,scrollbars=0,width=500px,height=800px"),!1}function resetLoginButton(){elements.loginButton.innerHTML='<span class="twitch-icon"></span> Sign in with Twitch'}function logout(){TWITCH={channel:"",access_token:"",userID:""},localStorage.setItem("TWITCH",JSON.stringify(TWITCH)),elements.loginButton.style.display="",elements.loginInfo.style.display="none",elements.username.innerText="Loading...",elements.loginInfoPFP.src="https://guessr.tv/pics/donk.png"}function loadInfo(){TWITCH=JSON.parse(localStorage.getItem("TWITCH")),elements.loginButton.style.display="none",elements.loginInfo.style.display="",elements.username.innerText=`Playing as ${TWITCH.channel}`,loadPFP(),elements.board.classList.remove("blur"),join();let e=shuffleArraySeed([...elements.cells].map((e=>e.innerText)),TWITCH.userID);for(let n=0;n<e.length;n++)elements.cells[n].innerText=e[n]}async function refresh(){elements.refresh.innerHTML=spinner;let e={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},redirect:"follow"};try{let n=await fetch(`https://bingo.guessr.tv/${elements.channel.innerText}/refresh`,e),t=await n.json();console.log(t),showToast(t.message,"info",3e3),elements.refresh.innerHTML='<i class="material-icons notranslate">refresh</i>'}catch(e){showToast("Could not refresh board","danger",3e3),console.log("refresh error",e),elements.refresh.innerHTML='<i class="material-icons notranslate">refresh</i>'}}async function loadPFP(){let e=await get7TVPFP(TWITCH.userID);"/pics/donk.png"==e&&TWITCH.access_token&&(e=await getTwitchPFP(TWITCH.channel,TWITCH.access_token)),elements.loginInfoPFP.src=e}async function join(){let e={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({userid:TWITCH.userID,username:TWITCH.channel,access_token:TWITCH.access_token,channel:elements.channel.innerText}),redirect:"follow"};try{let n=await fetch("https://bingo.guessr.tv/join",e),t=await n.json();showToast(t.message,"info",3e3)}catch(e){showToast("Could not join game","danger",3e3),console.log("join error",e)}}window.onload=async function(){loginExpiredModal=new bootstrap.Modal(elements.loginExpiredModal),TWITCH=JSON.parse(localStorage.getItem("TWITCH")),TWITCH?.access_token&&!await checkToken(TWITCH.access_token)&&(TWITCH.channel="",TWITCH.access_token="",loginExpiredModal.show()),TWITCH?.channel&&loadInfo();for(let e=0;e<elements.cells.length;e++)elements.cells[e].onclick=e=>{e.target.classList.toggle("filled")};enableTooltips()};