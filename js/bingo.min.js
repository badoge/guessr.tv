const suggestions=["VTuber","Streamer AFK","Over 10,000 viewers","Pet cam","IRL stream","Hottub stream","Watching a movie/TV show","Streamer you follow","Console stream","Speedrunning","Empty chat","Playing Slots","Sleeping during a subathon","Korean dancer","#AD stream","Reacting to videos","Low quality cam","Cam bigger than gameplay","NotLikeThis screen","ASMR stream","1k+ viewers with an inactive chat","Hand cam","Cosplaying","Random gifs in overlay","Driving stream","Esports tournament","Playing an instrument","Subscribers only chat","Room full of RGB lights"],elements={loginExpiredModal:document.getElementById("loginExpiredModal"),bingoItems:document.querySelectorAll(".bingo-item"),randomize:document.querySelectorAll(".bingo-random"),board:document.getElementById("board"),cells:document.querySelectorAll(".bingo-cell"),toastContainer:document.getElementById("toastContainer"),twitchEmbed:document.getElementById("twitchEmbed"),boardSize:document.getElementById("boardSize"),boardOpacity:document.getElementById("boardOpacity"),loginButton:document.getElementById("loginButton"),loginInfo:document.getElementById("loginInfo"),loginInfoPFP:document.getElementById("loginInfoPFP"),bingoLink:document.getElementById("bingoLink"),copyButton:document.getElementById("copyButton"),nextStream:document.getElementById("nextStream")};let loginExpiredModal,copyButton,player,TWITCH={channel:"",access_token:"",userID:""},mainList=[],retryLimit=0;async function getMainList(){try{let e=await fetch("https://api.okayeg.com/guess",requestOptions),t=await e.json();mainList=t.guess.guess}catch(e){console.log(e)}}async function nextStream(){if(elements.nextStream.disabled=!0,setTimeout((()=>{elements.nextStream.disabled=!1}),2e3),0==mainList.length)return void showToast("No more channels left on the list, refresh to get a new list","danger","3000");if(retryLimit>5)return void showToast("Too many retries, something might be wrong :(","danger","3000");let e=mainList.pop();try{let t=await fetch(`https://helper.pepega.workers.dev/twitch/streams?user_id=${e.userid}`,requestOptions);if(!(await t.json()).data[0])return showToast("Channel is offline, getting new channel","info",1500),retryLimit++,nextStream()}catch(e){return console.log(e),retryLimit++,nextStream()}retryLimit=0;let t={width:"100%",height:"100%",channel:e.username,layout:"video-with-chat",theme:"dark",parent:["guessr.tv","127.0.0.1"]};player?player.setChannel(e.username):player=new Twitch.Embed("twitchEmbed",t)}function dragElement(){let e=0,t=0,n=0,o=0;const l=()=>{document.onmouseup=null,document.onmousemove=null,elements.board.classList.remove("drag")},s=l=>{l.preventDefault(),e=n-l.clientX,t=o-l.clientY,n=l.clientX,o=l.clientY,elements.board.style.top=elements.board.offsetTop-t+"px",elements.board.style.left=elements.board.offsetLeft-e+"px"};elements.board.onmousedown=e=>{e.target.classList.contains("bingo-cell")||e.target.classList.contains("material-icons")||(e.preventDefault(),n=e.clientX,o=e.clientY,elements.board.classList.add("drag"),document.onmouseup=l,document.onmousemove=s)}}function randomize(e){const t=e.target.dataset.itemId,n=document.querySelector(`[data-item-id="${t}"]`),o=[...elements.bingoItems].map((e=>e.value));let l=suggestions[Math.floor(Math.random()*suggestions.length)];for(;o.includes(l);)l=suggestions[Math.floor(Math.random()*suggestions.length)];n.value=l}function randomizeAll(){let e=shuffleArray(structuredClone(suggestions));for(let t=0;t<elements.bingoItems.length;t++)elements.bingoItems[t].value=e.pop()}function bingoSave(){const e=shuffleArray([...elements.bingoItems].map((e=>e.value)));for(let t=0;t<elements.cells.length;t++)elements.cells[t].innerText=e[t],elements.cells[t].title=e[t]}function login(){return elements.loginInfoPFP.src="/pics/donk.png",elements.bingoLink.value="Loading...",elements.loginButton.innerHTML=spinner,window.open("/prompt.html","loginWindow","toolbar=0,status=0,scrollbars=0,width=500px,height=800px"),!1}function resetLoginButton(){elements.loginButton.innerHTML='<span class="twitch-icon"></span> Sign in with Twitch'}function logout(){TWITCH={channel:"",access_token:"",userID:""},localStorage.setItem("TWITCH",JSON.stringify(TWITCH)),elements.loginButton.style.display="",elements.loginInfo.style.display="none",elements.loginInfoPFP.src="/pics/donk.png",elements.bingoLink.value="https://bingo.guessr.tv"}async function loadPFP(){let e=await get7TVPFP(TWITCH.userID);"/pics/donk.png"==e&&TWITCH.access_token&&(e=await getTwitchPFP(TWITCH.channel,TWITCH.access_token)),elements.loginInfoPFP.src=e}function loadInfo(){elements.loginButton.style.display="none",elements.loginInfo.style.display="",elements.bingoLink.value=`https://bingo.guessr.tv/${TWITCH.channel}`,loadPFP()}function copyLink(){elements.bingoLink.select(),elements.bingoLink.setSelectionRange(0,99999),navigator.clipboard.writeText(elements.bingoLink.value),copyButton.show(),setTimeout((()=>{copyButton.hide()}),1e3)}window.onload=async function(){loginExpiredModal=new bootstrap.Modal(elements.loginExpiredModal),copyButton=new bootstrap.Tooltip(elements.copyButton),TWITCH=JSON.parse(localStorage.getItem("TWITCH")),TWITCH?.access_token&&!await checkToken(TWITCH.access_token)&&(TWITCH.channel="",TWITCH.access_token="",loginExpiredModal.show()),TWITCH?.channel&&loadInfo();for(let e=0;e<elements.cells.length;e++)elements.cells[e].onclick=e=>{e.target.classList.toggle("filled")};for(let e=0;e<elements.randomize.length;e++)elements.randomize[e].onclick=e=>{randomize(e)};elements.boardSize.oninput=function(){elements.board.style.scale=this.value},elements.boardOpacity.oninput=function(){elements.board.style.opacity=this.value},elements.board.addEventListener("mousewheel",(e=>{e.preventDefault(),e.stopPropagation();let t=parseFloat(getComputedStyle(elements.board).getPropertyValue("scale"));elements.board.style.scale=e.wheelDelta>0?Math.min(t+.07,2):Math.max(t-.07,.1),elements.boardSize.value=e.wheelDelta>0?t+.07:t-.07})),dragElement(),enableTooltips(),await getMainList(),shuffleArray(mainList),nextStream()};